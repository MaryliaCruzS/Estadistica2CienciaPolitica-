---
title: "SesiÃ³n 2"
output: html_document
---

# RegresiÃ³n De Poisson

<center><img src=" " width="200"/></center>

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 304 - EstadÃ­stica para el anÃ¡lisis polÃ­tico 2 \| Semestre 2025 - 1 <br>

## Docente: Marylia Cruz <br>

------------------------------------------------------------------------
</br>


## **ğŸ¯ Â¿Para quÃ© sirve la RegresiÃ³n de Poisson?**


La regresiÃ³n de Poisson es un modelo estadÃ­stico que se utiliza para **explicar una variable dependiente de tipo conteo**, es decir, cuando el resultado es un nÃºmero entero no negativo (0, 1, 2, 3, ...), y representa la frecuencia con la que ocurre un evento.

</br>

## **ğŸ“Œ Ejemplos comunes de uso?**


```{r, echo=FALSE, message=FALSE}
knitr::kable(
  data.frame(
    Contexto = c(
      "Salud pÃºblica",
      "SociologÃ­a",
      "EducaciÃ³n",
      "Transporte"
    ),
    `Variable dependiente - conteo` = c(
      "NÃºmero de hospitalizaciones por semana",
      "NÃºmero de protestas por regiÃ³n",
      "NÃºmero de cursos desaprobados",
      "NÃºmero de accidentes en una avenida"
    ),
    `Variables independientes` = c(
      "Edad, sexo, comorbilidades",
      "Pobreza, educaciÃ³n, presencia estatal",
      "Horas de estudio, asistencia",
      "IluminaciÃ³n, flujo vehicular"
    )
  ),
  caption = "Ejemplos de aplicaciÃ³n de la regresiÃ³n de Poisson",
  format = "markdown"
)

```

## **âš™ï¸Â¿CÃ³mo funciona?**

La variable de respuesta $Y$ sigue una distribuciÃ³n de Poisson.

El valor esperado de $Y$, denotado como $\lambda$, se relaciona con los predictores mediante una funciÃ³n logarÃ­tmica:

El modelo de regresiÃ³n de Poisson se expresa mediante la siguiente ecuaciÃ³n:

$$
\log(\lambda) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_k X_k
$$

donde:

$$
\lambda = e^{\beta_0 + \beta_1 X_1 + \dots + \beta_k X_k}
$$

Esto garantiza que $\lambda$ (el nÃºmero esperado de eventos) siempre sea positivo.

<br>

## **ğŸ§ªÂ¿CuÃ¡ndo usarla?**

- La variable dependiente es un conteo (no continua, ni categÃ³rica)

- Los valores son enteros â‰¥ 0

- Los eventos son independientes

- El conteo se produce en un intervalo fijo (tiempo, espacio, etc.)

- La media â‰ˆ varianza del conteo (si no, puede que necesites una regresiÃ³n binomial negativa)

## **ğŸ«¶Â¿CÃ³mo se realiza en R?**

Utilizaremos la base de datos de Protestas.

<a href="https://paideia.pucp.edu.pe/cursos/mod/resource/view.php?id=2373139">
  <button>Descargar la base de datos</button>
</a>

```{r}
library(rio)
data=import("Protestas.xlsx")
names(data)
```

*VD: Eventos de protestas:* NÃºmero de protestas realizadas en el 2022

## **EvaluaciÃ³n de Supuestos**

- Evaluar sobredispersiÃ³n (varianza vs media)

```{r}
# Calcular media y varianza de la variable dependiente
mean(data$EventosdeProtestas)
var(data$EventosdeProtestas)

# SobredispersiÃ³n si varianza > media significativamente
```

## **RegresiÃ³n Poisson**

Asumimos que si cumplimos el requisito:

```{r}
modelo_poisson <- glm(EventosdeProtestas ~ Salud + Educacion+Institucional, 
                      data = data, 
                      family = poisson())

summary(modelo_poisson)
```


```{r}
exp(coef(modelo_poisson))
```


## InterpretaciÃ³n de los coeficientes

- **Intercepto (`(Intercept)` = 3.10)**  
  Corresponde al logaritmo del nÃºmero esperado de eventos cuando todas las variables independientes son cero.  
  \[
  \exp(3.10) \approx 22.3
  \]  
  Es decir, se espera un promedio de **22 eventos** cuando Salud, EducaciÃ³n e Institucional son 0.

- **Salud (`coef = 0.32`, p < 0.001)**  
  A medida que aumenta el factor "Salud", el nÃºmero esperado de eventos **aumenta en un 38%**:  
  \[
  \exp(0.32) \approx 1.38
  \]

- **EducaciÃ³n (`coef = 0.06`, p â‰ˆ 0.093)**  
  Tiene un efecto dÃ©bilmente positivo sobre el nÃºmero de eventos, pero **no es estadÃ­sticamente significativa**.  
  \[
  \exp(0.06) \approx 1.07
  \]  
  Esto sugiere un posible aumento del 6.6% en los eventos, aunque con baja evidencia.

- **Institucional (`coef = -0.33`, p < 0.001)**  
  Tiene un efecto negativo claro. Un aumento en el componente institucional reduce el nÃºmero esperado de eventos en un **28%**: 
  
  
  \[
  \exp(-0.33) \approx 0.72
  \]


## ConclusiÃ³n

El modelo sugiere que mayores niveles en el sector salud estÃ¡n relacionados con un aumento en las protestas, mientras que una mayor capacidad institucional estÃ¡ asociada con una reducciÃ³n significativa en los eventos. La variable educaciÃ³n no presenta un efecto claro con suficiente evidencia estadÃ­stica.

## **ğŸ¯ Â¿Por quÃ© no basta la regresiÃ³n de Poisson?**

El modelo de Poisson asume que la varianza es igual a la media. Pero en datos reales de conteo (como protestas, enfermedades, delitos), eso casi nunca se cumple. Cuando hay sobredispersiÃ³n, los errores estÃ¡ndar del modelo Poisson se subestiman, y los p-valores no son confiables.

## ComparaciÃ³n entre modelos: Poisson, Quasi-Poisson y Binomial Negativa

A continuaciÃ³n, se presenta una tabla comparativa entre los modelos usados para datos de conteo con sobredispersiÃ³n:

```{r, echo=FALSE, message=FALSE}
library(knitr)

kable(
  data.frame(
    Modelo = c("Poisson clÃ¡sico", "Quasi-Poisson", "Binomial negativa"),
    `Corrige varianza` = c("No", "SÃ­ (Ï†Â·Î¼)", "SÃ­ (Î¼ + Î¼Â²/Î¸)"),
    `Cambia coeficientes` = c("No", "No", "SÃ­"),
    `Corrige errores estÃ¡ndar` = c("No", "SÃ­", "SÃ­"),
    `Maneja sobredispersiÃ³n fuerte` = c("No", "Moderadamente", "SÃ­"),
    `ComparaciÃ³n con AIC posible` = c("SÃ­", "No", "SÃ­"),
    `Paquete necesario` = c("base R", "base R", "MASS")
  ),
  caption = "ComparaciÃ³n entre modelos para conteo con sobredispersiÃ³n"
)
```

La diferencia estÃ¡ en la **varianza**:

- **Poisson clÃ¡sico:**

$$
\text{Var}(Y_i) = \mu_i
$$

## **Recomendaciones**

- Usa Quasi-Poisson si solo quieres corregir los errores estÃ¡ndar sin alterar los coeficientes.

- Usa Binomial negativa si la sobredispersiÃ³n es significativa y quieres una mejor estimaciÃ³n del modelo y su ajuste.


## **RegresiÃ³n Quasi Poisson**

Cuando te interesa ajustar varianza sin cambiar los coeficiente

Permite que la varianza sea mayor que la media

No cambia los coeficientes, pero ajusta los errores estÃ¡ndar para que los tests sean vÃ¡lidos

$$
\text{Var}(Y_i) = \phi \cdot \mu_i
$$

donde \( \phi \) es el parÃ¡metro de dispersiÃ³n estimado para corregir la varianza.


```{r}
modelo_qp <- glm(EventosdeProtestas ~ Salud + Educacion+Institucional, data = data, family = quasipoisson())
summary(modelo_qp)
```


## **RegresiÃ³n Binomial Negativa**

Este modelo introduce un parÃ¡metro adicional para manejar la sobredispersiÃ³n.

Te permite mantener la lÃ³gica de conteo, pero ajusta mejor la varianza.

Ajusta directamente la varianza:

En este modelo, la varianza depende **cuadrÃ¡ticamente** de la media:

$$
\log(\mu_i) = \beta_0 + \beta_1 X_{1i} + \dots + \beta_k X_{ki}
$$

$$
\text{Var}(Y_i) = \mu_i + \frac{\mu_i^2}{\theta}
$$

donde \( \theta \) es el parÃ¡metro que controla la sobredispersiÃ³n:  
- Si \( \theta \to \infty \), se aproxima al modelo de Poisson.
- Si \( \theta \) es pequeÃ±o, hay mucha sobredispersiÃ³n.

```{r}
library(dplyr)
# Este paso no es necesario, sirve para quedarnos solo con los departamentos con nÃºmero de eventos de protestas menor a 100 en el aÃ±a 2022
data=filter(data,EventosdeProtestas<100)
```

```{r}
library(MASS)

modelo_nb <- glm.nb(EventosdeProtestas ~ Salud + Educacion+Institucional, data = data)
summary(modelo_nb)
```
El modelo con menor AIC es preferible.

Si el modelo binomial negativa mejora el ajuste, confirma que la sobredispersiÃ³n era relevante.

```{r}
AIC(modelo_poisson, modelo_qp,modelo_nb)

```

Deben estar mÃ¡s centrados y sin patrÃ³n evidente.

```{r}
plot(residuals(modelo_nb, type = "pearson"))

```

## **Ejercicio para casa**

La base **quine** contiene informaciÃ³n sobre ausentismo escolar de estudiantes en Australia, recolectada en un estudio sobre educaciÃ³n.

Objetivo: Analizar quÃ© factores estÃ¡n asociados al nÃºmero de dÃ­as de ausencia de los estudiantes durante un aÃ±o escolar.

```{r}
library(MASS)
head(quine)
mean(quine$Days)
var(quine$Days)
```


</style>



<br></br> [Go to page beginning](#beginning)

