---
title: "Eventos historicos y An√°lisis de Supervivencia"
output: html_document
---

<center><img src=" " width="200"/></center>

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 304 - Estad√≠stica para el an√°lisis pol√≠tico 2 \| Semestre 2025 - 1 <br>

## Docente: Marylia Cruz <br>

------------------------------------------------------------------------
<br>

## **üéØ ¬øPara qu√© sirve los Eventos hist√≥ricos y el An√°lisis de Supervivencia?**

<br>

Para estudiar el tiempo que transcurre hasta que ocurre un evento espec√≠fico (muerte, abandono, reca√≠da, cambio de empleo, etc.) y analizar los factores que influyen en ese tiempo.

<br>

**Concepto clave:**

- **Evento hist√≥rico:** suceso de inter√©s cuya ocurrencia es registrada a lo largo del tiempo (ej.: muerte, reca√≠da, abandono escolar, divorcio, cambio de empleo).

- **Variable clave:** tiempo hasta el evento (tiempo de seguimiento o de permanencia).

- Importante: el evento puede no observarse para todos los casos ‚û§ aparece la censura.

</br>

- **Tipos de censura**

- 1. Censura a la derecha (la m√°s com√∫n)

Sabemos que el evento no ocurri√≥ durante el tiempo de observaci√≥n, pero no sabemos si o cu√°ndo ocurrir√° despu√©s.

üìå Ejemplos:

Un paciente sigue vivo al finalizar el estudio.
Una persona no ha abandonado su trabajo al cierre de la encuesta.
Un usuario no cancela su suscripci√≥n durante el periodo de seguimiento.

üîÅ Interpretaci√≥n: sabemos que el tiempo al evento es mayor que el observado.

- 2. Censura a la izquierda

El evento ya hab√≠a ocurrido antes de que comenzara el seguimiento, pero no sabemos exactamente cu√°ndo.

üìå Ejemplos:

Encuestamos a personas sobre edad al primer empleo, pero algunas ya estaban trabajando antes del periodo estudiado, sin recordar la edad exacta.
En un estudio de enfermedades cr√≥nicas, algunos participantes ya ten√≠an la enfermedad al ingresar al estudio, pero no se conoce el momento exacto del diagn√≥stico.

üîÅ Interpretaci√≥n: sabemos que el tiempo al evento es menor que el registrado.

- 3. Censura intervalada

No conocemos la fecha exacta del evento, pero sabemos que ocurri√≥ dentro de un intervalo de tiempo.

üìå Ejemplos:

Un paciente realiza chequeos m√©dicos anuales y en uno de ellos aparece la enfermedad, pero no sabemos cu√°ndo exactamente surgi√≥ entre chequeos.
Una mujer realiza un test de embarazo mensual. El test da negativo en enero y positivo en febrero: el evento (embarazo) ocurri√≥ entre ambos meses.

üîÅ Interpretaci√≥n: sabemos que el evento ocurri√≥ entre dos tiempos conocidos.


# **Ejemplos **

```{r, echo=FALSE}
knitr::kable(data.frame(
  `Caso de Estudio` = c("Ca√≠da de reg√≠menes democr√°ticos", "Firma de tratados de paz en guerras civiles",
                        "Estabilidad de coaliciones", "Transici√≥n democr√°tica", "Permanencia en alianzas"),
  `Evento de Inter√©s` = c("Quiebre del r√©gimen democr√°tico", "Firma del tratado de paz", 
                          "Disoluci√≥n de la coalici√≥n", "Democratizaci√≥n formal del r√©gimen", 
                          "Salida de la alianza"),
  `Unidad de An√°lisis` = c("Pa√≠s-a√±o", "Conflicto armado", "Coalici√≥n", "Pa√≠s", "Pa√≠s-alianza"),
  `Variable de Tiempo` = c("A√±os desde transici√≥n democr√°tica", "A√±os desde inicio del conflicto", 
                           "Meses desde formaci√≥n", "A√±os bajo r√©gimen autoritario", 
                           "A√±os desde entrada a la alianza"),
  `Censura` = c("Democracias a√∫n vigentes", "Conflictos a√∫n activos", 
                "Coaliciones a√∫n vigentes", "Pa√≠ses a√∫n autoritarios", "Pa√≠ses a√∫n miembros"),
  `Covariables Posibles` = c("PBI per c√°pita, fragmentaci√≥n, desigualdad", 
                              "Intervenci√≥n externa, intensidad", 
                              "Ideolog√≠a, liderazgo, crisis econ√≥mica", 
                              "Protestas, presi√≥n internacional", 
                              "Cambio de liderazgo, amenazas externas")
))

```


</br>

# **üìà AN√ÅLISIS KAPLAN-MEIER**

</br>

## **‚úÖ ¬øPara qu√© sirve?**

Estimar la probabilidad de "sobrevivir" m√°s all√° de cierto tiempo.
Comparar grupos de personas (por ejemplo, hombres vs. mujeres) en t√©rminos de duraci√≥n hasta el evento.

</br>


## **‚öôÔ∏è ¬øC√≥mo funciona?**

Divide el tiempo en intervalos donde ocurren eventos.
Calcula la probabilidad de sobrevivir en cada intervalo.
Maneja correctamente casos censurados (personas que no llegaron al evento durante el seguimiento).

</br>

## F√≥rmula del Estimador de Kaplan-Meier

El estimador de Kaplan-Meier se define como:

$$
\hat{S}(t) = \prod_{t_i \leq t} \left( 1 - \frac{d_i}{n_i} \right)
$$

donde:

- \( \hat{S}(t) \) es la probabilidad estimada de sobrevivir m√°s all√° del tiempo \( t \),
- \( t_i \) son los tiempos en los que ocurre al menos un evento,
- \( d_i \) es el n√∫mero de eventos (por ejemplo, muertes) ocurridos en el tiempo \( t_i \),
- \( n_i \) es el n√∫mero de individuos en riesgo justo antes de \( t_i \).



</br>

## **üìÖ ¬øCu√°ndo usarla?**

Cuando queremos describir la duraci√≥n hasta un evento.
Comparar curvas de supervivencia entre grupos sin ajustar por otras variables.



# **üõ† ¬øC√≥mo se realiza?**

Usar datos que incluyan:
Tiempo de seguimiento.
Evento (1 = ocurri√≥, 0 = censurado).
Grupo (si hay comparaci√≥n).
</style>


# **MODELO DE REGRESI√ìN DE COX**

## **‚úÖ ¬øPara qu√© sirve?**
Evaluar el efecto de varias variables sobre el tiempo al evento.
Calcular riesgos relativos (hazard ratios) ajustados.
No requiere asumir una forma espec√≠fica de la funci√≥n de supervivencia.

## **‚öôÔ∏è ¬øC√≥mo funciona?**

Estima c√≥mo las variables (edad, sexo, tratamiento...) afectan la raz√≥n de riesgo.
Utiliza una funci√≥n de riesgo basal no especificada y coeficientes exponenciales.
Supone que las razones de riesgo son constantes en el tiempo (proporcionalidad de riesgos).

## **üìÖ ¬øCu√°ndo usarla?**

Cuando se quiere hacer un an√°lisis multivariado del tiempo hasta el evento.
Ideal si hay variables continuas y categ√≥ricas.
Cuando se necesita ajustar por confusores.

## **üõ† ¬øC√≥mo se realiza?**

Base con:
Tiempo.
Evento (1/0).
Covariables (edad, sexo, etc.).

## Modelo de Regresi√≥n de Cox

El modelo de Cox, o modelo de riesgos proporcionales, se expresa como:

$$
h(t | X) = h_0(t) \cdot \exp(\beta_1 X_1 + \beta_2 X_2 + \cdots + \beta_p X_p)
$$

donde:

- \( h(t | X) \) es la funci√≥n de riesgo en el tiempo \( t \) dado el vector de covariables \( X \),
- \( h_0(t) \) es la **funci√≥n de riesgo basal** (baseline hazard), no especificada param√©tricamente,
- \( \beta_1, \beta_2, \dots, \beta_p \) son los coeficientes estimados para las covariables \( X_1, X_2, \dots, X_p \),
- \( \exp(\beta_j) \) se interpreta como el **hazard ratio** asociado a la covariable \( X_j \).

Este modelo permite estimar el efecto de las covariables sobre la raz√≥n de riesgo sin hacer suposiciones sobre la forma funcional de \( h_0(t) \), lo cual lo hace **semiparam√©trico**.


- Si \( \exp(\beta_j) > 1 \): mayor riesgo de ocurrencia del evento asociado a un aumento en \( X_j \),
- Si \( \exp(\beta_j) < 1 \): efecto protector o menor riesgo,
- El modelo asume **proporcionalidad de riesgos**, es decir, que los efectos de las covariables no cambian en el tiempo.


## ¬øC√≥mo se realiza en R el an√°lisis de eventos historicos?**

## Ejemplo:


Aunque la base ovarian tiene un origen cl√≠nico (c√°ncer de ovario), podemos usarla como una base para aprender an√°lisis de eventos hist√≥ricos (supervivencia).


- Cada paciente representa una "instituci√≥n p√∫blica" observada a lo largo del tiempo. El evento de inter√©s es "el colapso de la operaci√≥n institucional" (similar a una falla del tratamiento). Queremos saber cu√°nto tiempo permanecen activas y si las decisiones iniciales (como el tipo de intervenci√≥n recibida) afectan su duraci√≥n activa.



```{r}
# Paso 1: Cargar librer√≠as necesarias
library(survival)
library(survminer)

# Cargar base de datos
data("ovarian")
head(ovarian)



```


- futime	Tiempo hasta evento o censura (d√≠as)
- fustat	Estado: 1 = evento ocurri√≥, 0 = censurado
- rx	Tipo de tratamiento recibido (1 o 2)
- age	Edad de la paciente

# ¬øEl tipo de tratamiento recibido afecta la duraci√≥n de funcionamiento institucional (supervivencia)?

```{r}
library(survival)
library(survminer)

data("ovarian")

names(ovarian)
```

# Definimos el modelo

```{r}
km_modelo=survfit(Surv(futime,fustat)~rx,data=ovarian)
summary(km_modelo)
```

- A los 59 d√≠as, 13 personas segu√≠an en seguimiento, y ocurri√≥ 1 evento (falla). La probabilidad estimada de supervivencia hasta ese momento fue 92.3%.

- A los 115 d√≠as, el n√∫mero de personas en riesgo era 12, y ocurri√≥ otro evento. La probabilidad acumulada de seguir "viva" (sin evento) baj√≥ a 84.6%

# Gr√°fico

```{r}
ggsurvplot(km_modelo,
           data=ovarian,
           conf.int = TRUE,
           pval = TRUE,
           legend.labs=c("Tratamiento 1","Tramiento 2"),
           xlab="D√≠as",
           ylab="Probabilidad de supervivencia",
           title="Curva de Kaplan-Meier seg√∫n tratamiento")
```

- Puedes comparar qu√© grupo tiene una ca√≠da m√°s r√°pida, lo que indica menor supervivencia

- Puedes mirar el p-valor del test de log-rank en el gr√°fico (ggsurvplot(..., pval = TRUE)):
- Si p < 0.05, hay diferencias estad√≠sticamente significativas entre los grupos.

- Curvas que descienden m√°s lentamente indican mayor duraci√≥n / supervivencia.

- Curvas que caen r√°pido = mayor frecuencia de eventos (muertes, fallas, renuncias, etc.).

# ¬øQu√© es el test de log-rank?

Es una prueba no param√©trica que compara si hay diferencias significativas en la supervivencia entre dos o m√°s grupos a lo largo del tiempo.

- H‚ÇÄ (nula): Las curvas de supervivencia no presentan diferencias significativas en todos los grupos.


# Regreion de Cox

Estima el efecto de una o m√°s covariables sobre el hazard (tasa de riesgo) de ocurrencia del evento a lo largo del tiempo.

- La f√≥rmula general es:

```{r}
cox_model=coxph(Surv(futime,fustat)~rx+age,data=ovarian)
summary(cox_model)

```




- Estimamos el efecto del tipo de tratamiento y de la edad sobre el riesgo de colapso institucional.

- El hazard ratio de rx indica si un tratamiento acelera o retrasa el evento, controlando por la edad.


Si el HR de rx es < 1, entonces el tratamiento 2 reduce el riesgo de colapso, prolongando la duraci√≥n operativa.

Si el HR > 1, el tratamiento 2 acelera el evento, indicando menor supervivencia.

Si el p-valor < 0.05, la diferencia es estad√≠sticamente significativa.


- rx : tratamiento (expo del coeficiente 0.44)

Las personas que recibieron el tratamiento rx=2 tiene un 56% menos de riesgo de que ocurra el evento en comparaci√≥n con el grupo rx=1

- edad = ( expo coeficiente 1.158)

Por cada a√±o adicional de edad, el riesgo de que ocurra el evento aumenta en 15.8%, manteniendo constante el resto de los factores (independiente del tratamiento)



# Visualizaci√≥n

Esto genera un forest plot con los hazard ratios y sus intervalos de confianza.

```{r}
library(survminer)
ggforest(cox_model,data=ovarian)
```



- Una l√≠nea vertical en HR = 1: esta es la l√≠nea de no efecto.

Cada variable del modelo tiene:

- Un punto (el HR estimado),
- Una barra horizontal (intervalo de confianza al 95%)

##  Interpretaci√≥n del Hazard Ratio (HR) en gr√°ficos tipo Forest Plot

| Posici√≥n del HR con respecto a 1     | Interpretaci√≥n                                         |
|--------------------------------------|--------------------------------------------------------|
| HR a la derecha de 1                 | Aumenta el riesgo (**HR > 1**)                         |
| HR a la izquierda de 1               | Disminuye el riesgo (**HR < 1**, efecto protector)     |
| Intervalo de confianza cruza el 1    | No significativo (**p > 0.05**)                        |
| Intervalo de confianza fuera del 1   | Efecto estad√≠sticamente significativo (**p < 0.05**)   |


<a href="">
  <button>Descargar la base de datos</button>
</a>

<br></br> [Go to page beginning](#beginning)

